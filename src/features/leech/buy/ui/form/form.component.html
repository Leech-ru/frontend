@if (breakpoint() === "mobile") {
  <tui-app-bar>
    <button
      tuiAppBarBack
      tuiSlot="left"
      type="button"
      (click)="step.back()"
      [attr.aria-label]="step.getBackLabel()"
    ></button>
    <span> Оформление заказа </span>
    <span tuiSlot="right" tuiAppearance="action" class="tui-space_right-4">
      {{ form.index() + 1 }}/{{ steps.length }}
    </span>
  </tui-app-bar>

  <header tuiHeader class="tui-space_left-4 tui-space_top-4 tui-space_right-4">
    <h2 tuiTitle>{{ step.title }}</h2>
  </header>

  <div
    class="tui-space_top-4 tui-space_bottom-4 tui-space_right-4 tui-space_left-4"
    style="display: flex; flex: 1; flex-direction: column"
  >
    <ng-container *ngTemplateOutlet="stepsTemplate" />
  </div>

  <!-- Это нужно, чтобы при изменении размера экрана не было лишней анимации. -->
  <div [@.disabled]="breakpoint() !== 'mobile'">
    @if (step.state() === "pass") {
      <footer tuiFloatingContainer @tuiSlideInTop>
        <tui-elastic-container>
          <button tuiButton size="m" type="submit" (click)="step.next()">
            {{ step.getNextLabel() }}
          </button>
          @if (step.description) {
            <span [@tuiCrossFade]="{ bottom: '1rem' } | tuiAnimation">
              {{ step.description }}
            </span>
          }
        </tui-elastic-container>
      </footer>
    }
  </div>
} @else {
  <div tuiCardLarge tuiAppearance="floating">
    <tui-stepper [(activeItemIndex)]="form.index">
      @for (step of steps; track step.title) {
        <button
          tuiStep
          type="button"
          [disabled]="step.disabled ? step.disabled() : false"
          [stepState]="step.state()"
        >
          {{ step.title }}
        </button>
      }
    </tui-stepper>

    <header tuiHeader class="tui-space_top-4">
      <h2 tuiTitle>{{ step.title }}</h2>
    </header>

    <ng-container *ngTemplateOutlet="stepsTemplate" />

    @if (step.description) {
      <span tuiAppearance="action-grayscale">
        {{ step.description }}
      </span>
    }

    <footer>
      <button
        tuiButton
        size="m"
        iconStart="@tui.chevron-left"
        appearance="secondary"
        type="button"
        (click)="step.back()"
      >
        {{ step.getBackLabel() }}
      </button>
      <button
        tuiButton
        size="m"
        type="submit"
        [disabled]="step.state() !== 'pass'"
        (click)="step.next()"
      >
        {{ step.getNextLabel() }}
      </button>
    </footer>
  </div>
}

<ng-template #stepsTemplate>
  <ng-container [ngSwitch]="form.index()">
    <app-leech-buy-form-steps-leech
      *ngSwitchCase="0"
      (stateChange)="leechStepState.set($event)"
    />
    <app-leech-buy-form-steps-package
      *ngSwitchCase="1"
      (stateChange)="packageStepState.set($event)"
    />
    <app-leech-buy-form-steps-contact
      *ngSwitchCase="2"
      (stateChange)="contactStepState.set($event)"
    />
  </ng-container>
</ng-template>
